---
title: "Notebook Template"
author: Some One
date: YYYY-MM-DD
output: html_document
bibliography: references.bib
csl: elsevier-with-titles.csl
link-citations: true
---

```{r setup, include=FALSE}
library(knitcitations)
cite_options(citation_format = 'pandoc')
P <- rprojroot::find_rstudio_root_file
```

```{r setup2}
library(metaflu)
library(ggplot2)
library(parallel)
library(dplyr)
```

Set parameters for the simulator.  For now, no real network - just two unconnected
patches

```{r}
try_parms = list(
  beta = 0.004,                     #contact rate for direct transmission
  gamma = 0.167,                    #recovery rate
  mu = 0,                           #base mortality rate
  alpha = 0,                        #disease mortality rate
  phi = 1.96e-4,                    #infectiousness of environmental virions
  eta = 0.14,                       #degradation rate of environmental virions
  nu =  0.001,                      #uptake rate of environmental virion
  sigma = 1e5,                      #virion shedding rate
  omega = 0,                        #movement rate
  chi = matrix(c(1,0,0,1), nrow=2),  #patch connectivity matrix
  n_actions = 10                    # this really shouldn't be defined here.
)

initial_cond <- matrix(c(99, 1, 0, 0,
                         99, 1, 0, 0),
                       nrow=2, byrow=TRUE)
```

Run the simulator and plot

```{r runsim}
options(mc.cores=2)
output1 <- mf_sim(init = initial_cond, parameters = try_parms, times=0:1000, n_sims = 2, seed = 2, parallel = FALSE)
output2 <- mf_sim(init = initial_cond, parameters = try_parms, times=0:1000, n_sims = 2, seed = 2, parallel = TRUE)
output3 <- mf_sim(init = initial_cond, parameters = try_parms, times=0:1000, n_sims = 2, parallel = TRUE)

outputs <- bind_rows(output1, output2, output3, .id="run")

ggplot(outputs, aes(x=time, y=population, col=class, group=paste0(class, patch))) +
  facet_grid(run~sim) +
  geom_line()
```



```{r, include=FALSE}
write.bibtex(file=P("notebook/references.bib"))
```

## References

<div id="refs"></div>
